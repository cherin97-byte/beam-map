<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ì¸µë³„ ë„ë©´ - ë¶€ì¬ ìœ„ì¹˜ ë§µ</title>

  <!-- Leaflet CDN -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  />
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    defer
  ></script>

  <style>
    html, body { height: 100%; margin: 0; }
    #map { height: 100%; width: 100%; }

    .hint {
      position: absolute; z-index: 9999; left: 10px; top: 10px;
      background: rgba(255,255,255,0.92); padding: 8px 10px; border-radius: 8px;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      font-size: 14px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.15);
      line-height: 1.25;
    }

    .searchbox{
      position:absolute; z-index:9999; left:10px; top:70px;
      display:flex; gap:6px; align-items:center;
      background: rgba(255,255,255,0.92); padding:8px 10px; border-radius:8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.15);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
    }
    .searchbox input{
      width: 180px; padding: 6px 8px; border:1px solid #ccc; border-radius:6px;
      outline: none;
    }
    .searchbox button{
      padding: 6px 10px; border:1px solid #ccc; border-radius:6px; background:#fff;
      cursor:pointer;
    }

    .floorbar{
      position:absolute; z-index:9999; left:10px; top:122px;
      display:flex; flex-wrap:wrap; gap:6px;
      background: rgba(255,255,255,0.92); padding:8px 10px; border-radius:8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.15);
      max-width: calc(100vw - 40px);
    }
    .floorbar button{
      padding: 6px 10px; border:1px solid #ccc; border-radius:999px; background:#fff; cursor:pointer;
      white-space: nowrap;
    }
    .floorbar button.active{
      border-color:#333;
      font-weight:600;
    }

    /* ëª¨ë°”ì¼ì—ì„œ UIê°€ ë„ˆë¬´ ì»¤ì§€ì§€ ì•Šê²Œ */
    @media (max-width: 480px){
      .searchbox input{ width: 140px; }
      .hint{ font-size: 13px; }
    }
  </style>
</head>

<body>
  <div class="hint">
    ğŸ“Œ ë„ë©´ ë“œë˜ê·¸/í™•ëŒ€ ê°€ëŠ¥<br/>
    ğŸ” ë¶€ì¬ë²ˆí˜¸ ê²€ìƒ‰ (ì˜ˆ: B12) â†’ ìœ„ì¹˜ë¡œ ì´ë™<br/>
    (ë””ë²„ê·¸) ë„ë©´ í´ë¦­ ì‹œ ì¢Œí‘œê°€ ì½˜ì†”ì— ì¶œë ¥ë©ë‹ˆë‹¤.
  </div>

  <!-- ê²€ìƒ‰ UI -->
  <div class="searchbox">
    <input id="beamSearch" type="text" placeholder="ë¶€ì¬ë²ˆí˜¸ ê²€ìƒ‰ (ì˜ˆ: B12)" />
    <button id="beamSearchBtn">ì°¾ê¸°</button>
    <button id="beamClearBtn">ì´ˆê¸°í™”</button>
  </div>

  <!-- ì¸µ/ë™ ì„ íƒ UI -->
  <div class="floorbar">
    <button data-plan="B1F_A">B1F-Aë™</button>
    <button data-plan="B1F_B">B1F-Bë™</button>
    <button data-plan="1F_A">1F-Aë™</button>
    <button data-plan="1F_B">1F-Bë™</button>
  </div>

  <div id="map"></div>

  <script>
    window.addEventListener("load", () => {
      // ì§€ë„(ë„ë©´) ì´ˆê¸°í™”
      const map = L.map("map", {
        crs: L.CRS.Simple,
        minZoom: -2,
        maxZoom: 2,
        zoomSnap: 0.25,
        zoomDelta: 0.25
      });

      // ë„ë©´ ì˜¤ë²„ë ˆì´/ë§ˆì»¤ ë ˆì´ì–´ë¥¼ êµì²´ ê°€ëŠ¥í•˜ê²Œ ê´€ë¦¬
      let overlay = null;
      const markerLayer = L.layerGroup().addTo(map);
      let markerById = new Map();
      let bounds = null;

      /**
       * âœ… í”Œëœ(ì¸µ-ë™) ì •ì˜
       * - imageUrl: GitHubì— ì˜¬ë¦° ë„ë©´ ì´ë¯¸ì§€ íŒŒì¼ëª…
       * - width/height: í•´ë‹¹ ì´ë¯¸ì§€ ì‹¤ì œ í”½ì…€ í¬ê¸°
       * - beams: {id, x, y, status} ëª©ë¡
       *
       * âš ï¸ ë°˜ë“œì‹œ imageUrl íŒŒì¼ì´ GitHub ì €ì¥ì†Œ(root)ì— ì¡´ì¬í•´ì•¼ í•©ë‹ˆë‹¤.
       * âš ï¸ width/heightë¥¼ ì‹¤ì œ ì´ë¯¸ì§€ í¬ê¸°ë¡œ ë§ì¶°ì•¼ ì¢Œí‘œê°€ ì •í™•í•©ë‹ˆë‹¤.
       */
      const PLANS = {
        "B1F_A": {
          imageUrl: "B1F_A.png",
          width: 2000, height: 1200,
          beams: [
            { id: "B12", x: 820, y: 520, status: "ì¶œí•˜ì™„ë£Œ" },
            { id: "B13", x: 910, y: 540, status: "ë¯¸ì¶œí•˜" },
            { id: "G07", x: 320, y: 260, status: "ì¶œí•˜ì™„ë£Œ" },
          ]
        },
        "B1F_B": {
          imageUrl: "B1F_B.png",
          width: 2000, height: 1200,
          beams: [
            { id: "B21", x: 600, y: 400, status: "ë¯¸ì¶œí•˜" },
          ]
        },
        "1F_A": {
          imageUrl: "1F_A.png",
          width: 2000, height: 1200,
          beams: [
            { id: "A01", x: 1000, y: 600, status: "ì¶œí•˜ì™„ë£Œ" },
          ]
        },
        "1F_B": {
          imageUrl: "1F_B.png",
          width: 2000, height: 1200,
          beams: [
            { id: "B01", x: 450, y: 700, status: "ë¯¸ì¶œí•˜" },
          ]
        },
      };

      function setActivePlanButton(planKey){
        document.querySelectorAll(".floorbar button").forEach(btn => {
          btn.classList.toggle("active", btn.dataset.plan === planKey);
        });
      }

      function loadPlan(planKey){
        const p = PLANS[planKey];
        if(!p){
          alert("í”Œëœ ì •ì˜ê°€ ì—†ìŠµë‹ˆë‹¤: " + planKey);
          return;
        }

        // 1) ë„ë©´ êµì²´
        if(overlay) map.removeLayer(overlay);
        bounds = [[0, 0], [p.height, p.width]];
        overlay = L.imageOverlay(p.imageUrl, bounds).addTo(map);
        map.fitBounds(bounds);

        // 2) ë§ˆì»¤ êµì²´
        markerLayer.clearLayers();
        markerById = new Map();

        p.beams.forEach(b => {
          const marker = L.circleMarker([b.y, b.x], { radius: 8 }).addTo(markerLayer);
          marker.bindPopup(
            `<b>ë¶€ì¬ë²ˆí˜¸:</b> ${b.id}<br/>` +
            `<b>ìƒíƒœ:</b> ${b.status}<br/>` +
            `<small>ì¢Œí‘œ: (${b.x}, ${b.y})</small>`
          );
          markerById.set(String(b.id).trim().toUpperCase(), marker);
        });

        setActivePlanButton(planKey);
      }

      function focusBeam(idRaw){
        const id = String(idRaw || "").trim().toUpperCase();
        if(!id) return;

        const marker = markerById.get(id);
        if(!marker){
          alert(`'${id}' ë¶€ì¬ë¥¼ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.`);
          return;
        }
        const latlng = marker.getLatLng();
        map.setView(latlng, 0.5, { animate: true });  // ì¤Œê°’ì€ 0.5~1.5ì—ì„œ ì·¨í–¥ëŒ€ë¡œ ì¡°ì •
        marker.openPopup();
      }

      // ë²„íŠ¼ ì´ë²¤íŠ¸: í”Œëœ ì „í™˜
      document.querySelectorAll(".floorbar button").forEach(btn => {
        btn.addEventListener("click", () => loadPlan(btn.dataset.plan));
      });

      // ê²€ìƒ‰ ì´ë²¤íŠ¸
      document.getElementById("beamSearchBtn").addEventListener("click", () => {
        focusBeam(document.getElementById("beamSearch").value);
      });
      document.getElementById("beamSearch").addEventListener("keydown", (e) => {
        if(e.key === "Enter") focusBeam(e.target.value);
      });
      document.getElementById("beamClearBtn").addEventListener("click", () => {
        document.getElementById("beamSearch").value = "";
        if(bounds) map.fitBounds(bounds);
      });

      // (ë””ë²„ê·¸) ë„ë©´ í´ë¦­ ì‹œ ì¢Œí‘œ ì¶œë ¥: í•€ ì¢Œí‘œ ë”°ê¸°ìš©
      map.on("click", (e) => {
        const x = Math.round(e.latlng.lng);
        const y = Math.round(e.latlng.lat);
        console.log("CLICK XY =", { x, y });
      });

      // ìµœì´ˆ ë¡œë”© í”Œëœ
      loadPlan("B1F_A");
    });
  </script>
</body>
</html>
